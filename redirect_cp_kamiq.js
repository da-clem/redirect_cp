// Contents of redirectBasedOnCP.js
document.addEventListener('DOMContentLoaded', () => {
  const params = new URLSearchParams(window.location.search);
  const cp = params.get('cp'); // Make sure the URL contains a 'cp' parameter

  if (cp) {
    redirectToUrlWithCity(cp, params);
  }
});

function redirectToUrlWithCity(cp, params) {
  const villeCP = {
    "marseille": ["13190", "13380", "13240", "13109", "13001", "13002", "13003", "13004", "13005", "13007", "13010", "13011", "13012", "13013", "13014", "13015", "13016"],
    "marignane": ["13130", "13620", "13220", "13820", "13180", "13700", "13500", "13170", "13110", "13340", "13740", "13920", "13730", "13960", "13880", "13127", "13111"],
    "thionville": ["54260", "54560", "54190", "54720", "54870", "54400", "54680", "54730", "54860", "54440", "54590", "54810", "54135", "54350", "54920", "54430", "54650", "54880", "54620", "55150", "57440", "57480", "57390", "57710", "57570", "57310", "57320", "57113", "57920", "57110", "57134", "57330", "57290", "57190", "57650", "57240", "57100", "57940", "57700", "57840", "57270", "57180"],
    "epinay-sur-seine": ["92270", "92700", "92230", "92390", "93800", "93380", "93430", "95580", "95100", "95170", "95600", "95880", "95120", "95130", "95410", "95680", "95360", "95160", "95350", "95210", "95320", "95390", "95110", "95230"],
    "limoges": ["16150", "16420", "16500", "19210", "19510", "23430", "87000", "87110", "87130", "87140", "87150", "87160", "87170", "87190", "87200", "87210", "87220", "87230", "87240", "87250", "87260", "87270", "87290", "87300", "87310", "87320", "87330", "87340", "87350", "87360", "87370", "87380", "87400", "87410", "87420", "87430", "87440", "87480", "87500", "87510", "87520", "87570", "87590", "87600", "87620", "87640", "87700", "87720", "87800", "87890", "87920"],
    "metz": ["54610", "54800", "54560", "54150", "54530", "54700", "54580", "54490", "54620", "54980", "54890", "54640", "54111", "54470", "54780", "54310", "54240", "54380", "54970", "54960", "54660", "54750", "54870", "54910", "54121", "55400", "55300", "55230", "55210", "55270", "55150", "55100", "55430", "55160", "55240", "55110", "55320", "55840", "57920", "57590", "57111", "57360", "57580", "57130", "57640", "57680", "57530", "57176", "57300", "57050", "57310", "57159", "57420", "57365", "57160", "57245", "57070", "57120", "57210", "57175", "57144", "57157", "57140", "57000", "57158", "57860", "57117", "57250", "57780", "57118", "57124", "57525"],
    "sarreguemines": ["57340", "57410", "57580", "57380", "57670", "57520", "57660", "57730", "57320", "57170", "57690", "57220", "57450", "57260", "57460", "57800", "57550", "57200", "57230", "57720", "57490", "57590", "57150", "57980", "57136", "57510", "57600", "57430", "57470", "57880", "57910", "57630", "57990", "57114", "57740", "57540", "57890", "57530", "57500", "57115", "57350", "57137", "57145", "67260", "67970"],
    "tomblaine": ["54115", "54740", "54770", "54460", "54170", "54112", "54450", "54200", "54540", "54470", "54110", "54760", "54370", "54510", "54380", "54160", "54385", "54210", "54122", "54120", "54290", "54550", "54360", "54610", "54940", "54480", "54300", "54700", "54113", "54136", "54930", "54280", "54134", "54420", "54230", "54250", "54330", "54670", "54119", "54130", "54830", "54270", "54690", "54630", "54710", "54840", "54570", "54390", "54180", "54140", "54114", "54410", "54950", "54520", "54129", "54220", "54820", "54320", "54850", "54118", "54000", "54340", "54116", "54500", "54600", "54123", "54990", "55130", "55300", "55200", "55140", "55190", "57590", "57170", "57630", "57810", "88140", "88500", "88170", "88300", "88130", "88800", "88630", "88700"],
  };

  let ville = Object.keys(villeCP).find(ville => villeCP[ville].includes(cp));

  if (ville) {
    const newBaseURL = `https://skoda-fabia-essai.novperfs.com/concessions/${ville}`;
    const finalUrl = `${newBaseURL}?${params.toString()}`;
    window.location.href = finalUrl;
  } else {
    console.log("Code postal non géré.");
  }
}
